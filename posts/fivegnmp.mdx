---
title: "5G Networked Music Performances"
date: "2023-02-10"
keywords: ["audio", "network", "5g", "nmp", "research"]
summary: "Me and a colleague got in touch with Telenor Research and did some experiments to see if it's possible to play music together over 5G. Here are the preliminary results."
---

{/* <MyImage src="/img/5G-logo.png" alt="5G logo" /> */}

5G is the new paradigm of telecommunication and wireless networking. The greatest difference between 4G to 5G is a massive increase in speed (bandwidth) due to updated network infrastructure. We imagine remote-controlled surgery, distributed sporting events, and even stable Networked Music Performances (NMP).

Playing music over the network is highly challenging because of exceptionally high demands for low latency and fast communication. In fact, research tells us that the ideal roundtrip latency for synchronous NMPs is between 25-50ms. For perspective, here is 30ms of audio delay from left to right channel:

<MyAudioPlayer
  src="/audio/fiveg-30ms-delay.mp3"
  newOptions={{ splitChannels: true }}
/>

In 2022, me and my colleague (<MyLink href="https://stefanofasciani.com/">Stefano Faciani</MyLink>) got in touch with Telenor Research to explore the feasibility of conducting NMPs over 5G. During spring, we were able to schedule two experiments where we met and collaborated on a series of audio transmission tests on private and commercial 5G networks. In this post, I present the experiments in detail and the preliminary results.

# Content

1. <MyLink href="#test-sites-and-equipment">Test sites and Equipment</MyLink>
2. <MyLink href="#testing-methodology">Testing Methodology</MyLink>
   1. <MyLink href="#network-coverage">Network Coverage</MyLink>
   2. <MyLink href="#signal-quality">Signal Quality</MyLink>
   3. <MyLink href="#roundtrip-latency">Roundtrip Latency</MyLink>
3. <MyLink href="#results">Results</MyLink>
   1. <MyLink href="#commercial-5g">Commercial 5G</MyLink>
   2. <MyLink href="#private-5g">Private 5G</MyLink>
4. <MyLink href="#summary-and-ahead">Summary and Ahead</MyLink>

<hr />

<h1 id="test-sites-and-equipment">Test sites and Equipment</h1>

To connect to their 5G, Telenor provided us with a pair of Huawei H138-380 CPE Pro 3 5G Routers. The modems were pre-configured to access specific Access-Point-Names (APNs) based on our location to enable faster packet routing and better p2p connectivity at the test site.

The first experiment we were able to do was on a first-generation commercial 5G network at the Musicology Department (IMV), UiO. A little later, we got the opportunity to run some tests on a private 5G Network-on-Wheels (5GNoW) at the Terningmoen Army Base in Elverum. The 5GNoW is apparently only used for specialized field experiments.

<MySlideshow
  imgs={["5G-modems-outside-salen.jpg", "5G-now.jpg"]}
  captions={[
    "Our 5G Routers in action outside the Musicology Department at UiO, ready to test the commercial NSA 5G network.",
    "Telenor's 5GNoW van at Terningmoen Army Base, Elverum. Photo by Olai Bendik Erdal.",
  ]}
/>

To transmit audio back and forth, we used custom <MyLink href="https://github.com/MCT-master/NMP-Portable-Kits/wiki">NMP hardware kits</MyLink> built for educational and research purposes at IMV. These hardware bundles are designed specifically for ultra-low-latency AV transmission, given they have the right network conditions and software.

For the software, we ran the <MyLink href="https://www.jacktrip.org">JackTrip</MyLink> and Qjack to transmit uncompressed audio.

<MySlideshow
  imgs={[
    "5G-lolaracks.jpg",
    "5G-meandstefano-elverum.jpg",
    "5G-racksontheroad.jpg",
  ]}
  captions={[
    "NMP kits in action at UiO",
    "Setting up the NMP kits at Terningsmoen. From left: Stefano Fasciani and me. Photo by Olai Bendik Erdal.",
    "The NMP kits ready for the road to Terningsmoen Army Base, Elverum.",
  ]}
/>

<h1 id="testing-methodology">Testing Methodology</h1>

Having lightning-fast communication is always a high priority for any NMPs. However, having low latency is not synonymous with high-quality signals with minimal dropouts and unwanted artifacts (glitches).

Therefore, to test whether 5G can accommodate NMPs, we tried to find the best possible tradeoff between **stability**, **quality**, and **latency** on private and commercial 5G networks for audio transmission.

We did three tests at each location:

<h3 id="network-coverage">1) Network Coverage</h3>

By using a combination of <MyLink href="https://iperf.fr/">iPerf</MyLink> networking utilities, the Huawei routers' location-optimizing software, <MyLink href="https://www.telenor.no/dekning/#dekningskart">Telenorâ€™s online coverage map</MyLink>, and <MyLink href="https://www.speedtest.net/">Oorkla's online speedtester</MyLink>, we were able to make network bandwidth and coverage estimates throughout the experiments, ensuring that our load did not exceed the capacity of the network.

<h3 id="signal-quality">2) Signal Quality</h3>

To find the quality-stability sweetspots, we created loopback systems between our two NMP kits over the 5G networks, as depicted in the diagram below. By listening and inspecting the audio we sent across these loopback systems (preferably a single mid-range sine tones), we could monitor the audio quality of our connections in real-time.

<MyImage
  src="/img/5G-latency-method.jpg"
  alt="latency measurement diagram"
  caption="This diagrams shows how to setup for measuring audio quality and roundtrip latency in NMP systems with two clients."
/>

If there were any unwanted artifacts, glitches, or drops, we adjusted the software and hardware buffers to locate the lowest possible configuration that ensured stable transmission over a significant period.

<h3 id="roundtrip-latency">3) Roundtrip Latency</h3>

With the software and hardware parameters fine-tuned for quality, we went on to measure the digital and analog audio roundtrip time (RTT).

With digital RTT, we refer to the time it takes audio to travel from software to software (or PC to PC) and back again. With this method, we bypass and control for the latency induced by our external soundcards and mixer hardware.

By including this additional hardware, we measured the analog RTT. To achieve higher accuracy and certainty in our analog RTT measurements, we used a secondary pc+soundcard setup, as shown in the diagram below.

<MyImage
  src="/img/5G-latency-method-third-laptop.png"
  alt="latency measurement third laptop diagram"
/>

With this configuration, we could bypass and control latency compensation mechanisms and other unwanted side effects caused by our hardware or software modules.

<h1 id="results">Results</h1>

<h3 id="commercial-5g">Commercial 5G</h3>

Since the 5G reception inside IMV was poor, we decided to place the routers outside, hoping it would generate better coverage and boost overall performance. Just outside IMV's main auditorium (at <MyLink href="https://www.google.com/maps/place/59%C2%B056'13.4%22N+10%C2%B043'13.9%22E/@59.9370556,10.7205278,226m/data=!3m2!1e3!4b1!4m4!3m3!8m2!3d59.9370556!4d10.7205278">this location</MyLink>), we measured a stable 75% 5G coverage with 60Mbps bandwidth.

When using buffer sizes below 512 in our audio interfaces, the quality was bad with massive dropouts and periodic glitches. Considering that buffering 512 samples at 48Khz takes 10ms and that our audio had to pass through our audio interfaces 4x times during our loopback system, we understand that a buffer size of 512 is quite high for NMP activities.

We measured the average digital and analog RTT to be 110ms and 165ms (respectively) on the commercial 5G network.

**Demo** - 165ms audio delay from left to right ear:

<MyAudioPlayer
  src="/audio/fiveg-165ms-delay.mp3"
  newOptions={{ splitChannels: true }}
/>

<h3 id="private-5g">Private 5G</h3>

During our second round of testing on a private 5GNoW in Elverum, time was of the essence. We only had about 3-4 hours to set up our equipment and ran into unexpected connectivity and bandwidth issues from the very start.

However, we were able to get better results overall on the private 5G network. When using a buffer size of 256, we measured an average digital and analog RTT of 60ms and 74ms (respectively).

**Demo** - 74ms audio delay from left to right ear:

<MyAudioPlayer
  src="/audio/fiveg-74ms-delay.mp3"
  newOptions={{ splitChannels: true }}
/>

But although this was impressive, the configuration rendered borderline audio quality that would be unpleasant in the long run. When using a buffersize of 512, we got much more stable audio with 90-100ms digital RTT (similar to experiment nr.1, only slightly faster) and an analog RTT at about 140ms.

Results in table form:

<MyTable
  cols={[
    ["Network", "Commercial", "Private", "Private2"],
    ["Audio", "48Khz 16bit stereo", "48Khz 16bit stereo", "48Khz 16bit stereo"],
    ["Buffer Size", "512", "256", "512"],
    ["Digital RTT", "110ms", "60ms", "90ms"],
    ["Analog RTT", "165ms", "74ms", "140ms"],
  ]}
/>

<h1 id="summary-and-ahead">Summary and Ahead</h1>

In early 2022, me and a UiO colleague investigated the feasibility of conducting NMPs over commercial and private 5G networks in collaboration with Telenor Research. We measured the stability, quality, and latency of transferring uncompressed audio over two 5G networks with high-end hardware and software utilities. When accepting borderline conditions on a private 5G network (5GNoW), we managed to push the audio RTT latency down to 75ms. However, in more realistic conditions on a first-generation commercial 5G, we achieved an analog RTT audio latency of 165ms.

Compared with audio RTT benchmarks mentioned in the introduction (between 25-50ms), our 5G test results were not particularly promising. I believe we could conduct successful NMPs over 5G if we could get the audio analog RTT down between 50-70ms. Considering that we had unfortunate testing conditions in Elverum, there is reason to be optimistic about achieving better RTT audio scores at a later stage.

Also, lower latency should be possible when the Ultra-Reliable Low Latency Communications (URLLC) feature of 5G is implemented on future Telenor networks.

<MySlideshow
  imgs={["5G-henrik-stefano-salen.jpg", "5G-team.jpg"]}
  captions={[
    "A big thanks to the Telenor Research team. From front to back: Aleksander Tidemann (Department Engineer UiO), Stefano Fasciani (Professor in Musicology UiO), Kashif Mahmood (Senior Researcher Telenor), Olai Bendik Erdal (Senior Researcher Telenor) and Ole GrÃ¸ndalen (Senior Researcher Telenor)",
    "Also, a big thanks to research assistant Henrik Harald Sveen for helping out at UiO.",
  ]}
/>
