---
title: "5g Networked Music Performances"
date: "2023-02-10"
keywords: ["audio", "network", "5g", "nmp", "research"]
summary: "Me and a colleague teamed up with Telenor Research to see what it takes to play music together over next generation 5g networks. Here are the preliminary results."
---

5g is the new paradigm of telecommunication and wireless networking. The greatest difference between 4G to 5g is a massive increase in speed (bandwidth) due to updated network infrastructure. We imagine remote-controlled surgery, distributed sporting events, and even stable Networked Music Performances (NMP).

Playing music over the network is highly challenging because of its exceptionally high demands for low latency and fast communication. In fact, research tells us that the ideal roundtrip audio latency for synchronous (real-time) NMPs is between 25-50ms.

**Demo** - For perspective, here is 30ms of audio delay from left to right channel:

<MyAudioPlayer
  src="/audio/fiveg-30ms-delay.mp3"
  newOptions={{ splitChannels: true }}
/>

In 2022, me and my colleague (<MyLink href="https://stefanofasciani.com/">Stefano Faciani</MyLink>) got in touch with Telenor Research to explore the feasibility of conducting NMPs over 5g. During spring, we were able to schedule two experiments where we met and collaborated on a series of audio transmission tests on private and commercial 5g networks. In this post, I present the experiments in detail and the preliminary results.

# Content

1. <MyLink href="#test-sites-and-equipment">Test sites and Equipment</MyLink>
2. <MyLink href="#testing-methodology">Testing Methodology</MyLink>
   1. <MyLink href="#network-coverage">Network Coverage</MyLink>
   2. <MyLink href="#signal-quality">Signal Quality</MyLink>
   3. <MyLink href="#roundtrip-latency">Roundtrip Latency</MyLink>
3. <MyLink href="#results">Results</MyLink>
4. <MyLink href="#summary">Summary</MyLink>

<hr />

<h1 id="test-sites-and-equipment">Test sites and Equipment</h1>

To connect to their 5g, Telenor provided us with a pair of Huawei H138-380 CPE Pro 3 5g Routers. The modems were pre-configured to access specific Access-Point-Names (APNs) based on our location to enable faster packet routing and better p2p connectivity at the test site.

The first experiment we did was on a first-generation commercial 5g network at the Musicology Department (IMV), UiO. A little later, we got the opportunity to run some tests on a private 5g Network-on-Wheels (5gNoW) at the Terningmoen Army Base in Elverum. The 5gNoW is apparently only used for specialized field experiments.

<MySlideshow
  imgs={["5g-modems-outside-salen.jpg", "5g-now.jpg"]}
  captions={[
    "Our 5g Routers in action outside the Musicology Department at UiO, ready to test the commercial NSA 5g network.",
    "Telenor's 5gNoW van at Terningmoen Army Base, Elverum. Photo by Olai Bendik Erdal.",
  ]}
  width="600"
/>

To transmit audio back and forth, we used custom <MyLink href="https://github.com/MCT-master/NMP-Portable-Kits/wiki">NMP hardware kits</MyLink> built for educational and research purposes at IMV. These hardware bundles are designed specifically for ultra-low-latency AV transmission, given they have the right network conditions and software.

We ran <MyLink href="https://www.jacktrip.org">JackTrip</MyLink> and Qjack as our software solution to transmit uncompressed audio over ther network.

<MySlideshow
  imgs={[
    "5g-lolaracks.jpg",
    "5g-meandstefano-elverum.jpg",
    "5g-racksontheroad.jpg",
  ]}
  captions={[
    "NMP kits in action at UiO",
    "Setting up the NMP kits at Terningsmoen. From left: Stefano Fasciani and me. Photo by Olai Bendik Erdal.",
    "The NMP kits ready for the road to Terningsmoen Army Base, Elverum.",
  ]}
/>

<h1 id="testing-methodology">Testing Methodology</h1>

Having lightning-fast communication is always a high priority for any NMP. However, low latency is not synonymous with high-quality signals with minimal dropouts and unwanted artifacts (glitches).

Therefore, to test whether 5g can accommodate NMPs, we tried to find the best possible tradeoff between stability, quality, and latency on private and commercial 5g networks for audio transmission.

We did three tests at each location:

<h3 id="network-coverage">1) Network Coverage</h3>

By using a combination of <MyLink href="https://iperf.fr/">iPerf</MyLink> networking utilities, measurements from the Huawei routers' software, <MyLink href="https://www.telenor.no/dekning/#dekningskart">Telenorâ€™s online coverage map</MyLink>, and <MyLink href="https://www.speedtest.net/">Ookla's online speedtester</MyLink>, we were able to make network bandwidth and coverage estimates throughout the experiments, ensuring that our load did not exceed the capacity of the networks.

<h3 id="signal-quality">2) Signal Quality</h3>

To locate the quality and stability sweetspots for our audio transmission, we created a network loopback systems between our two NMP kits, as depicted in the diagram below. By listening and inspecting the audio we sent across these loopback systems (preferably a single mid-range sine tones), we could monitor the audio quality of our connections in real-time.

<MyImage
  src="/img/5g-latency-method.jpg"
  alt="latency measurement diagram"
  caption="Setting up a networked loopback system enables us to measure audio quality, stability, and roundtrip latency from one single location."
/>

Upon experiencing unwanted artifacts, glitches, or drops in the audio, we simply adjusted the software and hardware buffer sizes to locate the lowest possible configuration that ensured stable transmission over a significant period.

<h3 id="roundtrip-latency">3) Roundtrip Latency</h3>

With the software and hardware parameters fine-tuned, we used the same loopback system to measure the digital and analog audio roundtrip time (RTT).

With digital RTT, we refer to the time it takes audio to travel from software to software (or PC to PC) and back again. With this method, we bypass and control for the latency induced by our external soundcards and mixer hardware.

By including this additional hardware, we measure the analog RTT. This measurement is the most relevant metric for NMP musicians because it captures the entire audio chain.

<MyImage
  src="/img/5g-latency-method-third-laptop.png"
  alt="latency measurement third laptop diagram"
  caption="Using a third device to measure RTT between two clients can help achieve higher accuracy and precision measurements. The term 'Lola rack' in the diagram refers to the NMP kits."
/>

To achieve higher accuracy and certainty in our analog RTT measurements, we used a secondary pc+soundcard setup, as shown in the diagram above. With this configuration, we bypass and control unwanted latency compensation mechanisms and other side effects caused by our hardware or software modules.

<h1 id="results">Results</h1>

<h3 id="commercial-5g">Commercial 5g</h3>

Since the 5g reception inside IMV was poor, we decided to place the routers outside, hoping it would generate better coverage and boost overall performance. Just outside IMV's main auditorium (at <MyLink href="https://www.google.com/maps/place/59%C2%B056'13.4%22N+10%C2%B043'13.9%22E/@59.9370556,10.7205278,226m/data=!3m2!1e3!4b1!4m4!3m3!8m2!3d59.9370556!4d10.7205278">this location</MyLink>), we measured a stable 75% 5g coverage with 60Mbps bandwidth.

The audio quality was consistently bad, with massive dropouts and periodic glitches, on the 5g commercial network when we used buffer sizes below 512. Processing 512 samples at 48Khz takes 10ms. Althought that might sound fast, if we consider that our audio had to pass through our audio interfaces 4x times during our loopback system, we see that a buffer size of 512 is quite borderline for NMP activities.

We measured the average digital and analog RTT to be 110ms and 165ms (respectively) on the commercial 5g network.

**Demo** - 165ms audio delay from left to right ear:

<MyAudioPlayer
  src="/audio/fiveg-165ms-delay.mp3"
  newOptions={{ splitChannels: true }}
/>

<h3 id="private-5g">Private 5g</h3>

During our second round of testing, time was of the essence. We only had about 3-4 hours to set up our equipment and run tests on the private 5gNoW in Elverum. From the very start, we ran into unexpected connectivity and bandwidth issues, but we managed to get a stable 14-15Mbps link which is more than enough for stereo uncompressed audio.

On the private 5g, we were able to get better overall results overall. When using a buffer size of 256, we measured an average digital and analog RTT of 60ms and 74ms (respectively).

**Demo** - 74ms audio delay from left to right ear:

<MyAudioPlayer
  src="/audio/fiveg-74ms-delay.mp3"
  newOptions={{ splitChannels: true }}
/>

Although this was impressive, the configuration rendered borderline audio quality that would be unpleasant in the long run. When using a buffer size of 512, we got much more stable audio with 90-100ms digital RTT (similar to the commercial 5g, only slightly faster) and an analog RTT at about 140ms.

Results in table form:

<MyTable
  cols={[
    ["Network", "Commercial", "Private (risky)", "Private (safe)"],
    ["Audio", "48Khz 16bit stereo", "48Khz 16bit stereo", "48Khz 16bit stereo"],
    ["Buffer Size", "512", "256", "512"],
    ["Digital RTT", "110ms", "60ms", "90ms"],
    ["Analog RTT", "165ms", "74ms", "140ms"],
  ]}
/>

<h1 id="summary">Summary</h1>

In early 2022, me and a UiO colleague investigated the feasibility of conducting NMPs over commercial and private 5g networks in collaboration with Telenor Research. We measured the stability, quality, and latency of transferring uncompressed audio over two 5g networks with high-end hardware and software utilities. When accepting borderline conditions on a private 5g network (5gNoW), we managed to push the audio RTT latency down to 75ms. However, in more realistic conditions on a first-generation commercial 5g, we achieved an analog RTT audio latency of 165ms.

<MySlideshow
  imgs={["5g-henrik-stefano-salen.jpg", "5g-team.jpg"]}
  captions={[
    "Also, a big thanks to research assistant Henrik Harald Sveen for helping out at UiO.",
    "A big thanks to the Telenor Research team.",
  ]}
/>

Compared with audio RTT benchmarks mentioned in the introduction (between 25-50ms), our 5g test results were not particularly promising. I believe we could conduct successful NMPs over 5g if we could get the audio analog RTT down between 50-70ms. Considering that we had unfortunate testing conditions in Elverum, there is reason to be optimistic about achieving better RTT audio scores at a later stage.

Also, lower latency should be possible when the Ultra-Reliable Low Latency Communications (URLLC) feature of 5g is implemented on future Telenor networks.
